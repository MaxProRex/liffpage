<!DOCTYPE html>
<html>
<head>
  <title>打卡定位</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>打卡定位</h2>
  <button onclick="startCheckIn()">打卡</button>

  <script>
    const WHITELIST = ['U79020fb63e5c20703ee2cb9f34c0df02', 'Uyyyyyyyyyy']; // 你的 LINE 使用者 ID 清單
    const GAS_WEBHOOK = 'https://script.google.com/macros/s/AKfycbzASDfmyeoqaX3vCorH8qQr-TCMDKYp-2X_AulwC94F2SnCfOusWeE0MixhrpJyEf5o/exec';

    async function startCheckIn() {
      await liff.init({ liffId: '你的 LIFF ID' });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      const userId = profile.userId;

      if (!WHITELIST.includes(userId)) {
        alert('您不在打卡清單中');
        return;
      }

      navigator.geolocation.getCurrentPosition(function(position) {
        const payload = {
          userId,
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
          timestamp: new Date().toISOString()
        };

        fetch(GAS_WEBHOOK, {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: { 'Content-Type': 'application/json' }
        }).then(res => res.json())
          .then(data => alert('打卡成功！'));
      });
    }
  </script>
</body>
</html>
